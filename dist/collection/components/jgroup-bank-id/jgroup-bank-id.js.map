{"version":3,"file":"jgroup-bank-id.js","sourceRoot":"","sources":["../../../../src/components/jgroup-bank-id/jgroup-bank-id.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Host,\n  Prop,\n  State,\n  h,\n  Watch,\n  Listen,\n  Event,\n  EventEmitter,\n} from '@stencil/core';\nimport {\n  getQrCodeImageUrl,\n  useDevice,\n  // readCookie,\n  getHashParams,\n} from './../../utils/utils';\nimport { createTranslateFunction } from './localization';\nimport { Alert, StartButton, CancelButton } from './components';\nimport axios from 'axios';\n\n@Component({\n  tag: 'jgroup-bank-id',\n  styleUrl: 'jgroup-bank-id.css',\n  shadow: true,\n  assetsDirs: ['./../assets'],\n})\nexport class JgroupBankId {\n  /**\n   * Emitted when the BankID process is completed\n   */\n  @Event() completed: EventEmitter;\n\n  /**\n   * The type of BankID action to perform\n   */\n  @Prop() readonly type: 'auth' | 'sign';\n\n  @Watch('type')\n  validateType(newValue: string) {\n    if (!['auth', 'sign'].includes(newValue)) {\n      this.throwError(\n        `The 'type' attribute is required and must be either 'auth' or 'sign'.`,\n      );\n    }\n  }\n\n  /**\n   * The URL responsible for initiating a sign process\n   */\n  @Prop() readonly signUrl: string;\n\n  @Watch('signUrl')\n  validateSignUrl(newValue: string) {\n    if (this.type === 'sign' && newValue === undefined) {\n      this.throwError(\n        `The 'sign-url' attribute is required when 'type' is set to 'sign'.`,\n      );\n    }\n  }\n\n  /**\n   * The URL responsible for initiating an auth process\n   */\n  @Prop() readonly authUrl: string;\n\n  @Watch('authUrl')\n  validateAuthUrl(newValue: string) {\n    if (this.type === 'auth' && newValue === undefined) {\n      this.throwError(\n        `The 'auth-url' attribute is required when 'type' is set to 'auth'.`,\n      );\n    }\n  }\n\n  /**\n   * The URL responsible for collecting the status of the process\n   */\n  @Prop() readonly collectUrl: string;\n\n  @Watch('collectUrl')\n  validateCollectUrl(newValue: string) {\n    if (newValue === undefined) {\n      this.throwError(`The 'collect-url' attribute is required.`);\n    }\n  }\n\n  /**\n   * The URL responsible for cancelling a started process\n   */\n  @Prop() readonly cancelUrl: string;\n\n  @Watch('cancelUrl')\n  validateCancelUrl(newValue: string) {\n    if (newValue === undefined) {\n      this.throwError(`The 'cancel-url' attribute is required.`);\n    }\n  }\n\n  @Listen('visibilitychange', { target: 'document' })\n  handleVisibilityChange() {\n    if (document.visibilityState === 'hidden') {\n      return;\n    }\n\n    const hashParams: { initiated?: string } = getHashParams(location.hash);\n\n    if (\n      hashParams.initiated !== undefined ||\n      window.history.state.triggeredByUser === true\n    ) {\n      this.flowType = 'app';\n      this.isInProgress = true;\n      this.pollCollect();\n    }\n  }\n\n  /**\n   * Whether to use the dark theme\n   */\n  @Prop() readonly darkTheme = false;\n\n  /**\n   * The language to use for localization\n   */\n  @Prop() readonly language: 'sv' | 'en' = null;\n\n  @State() flowType: 'app' | 'qr';\n\n  @State() isMobileOrTablet = null;\n\n  @State() isStarting = false;\n\n  @State() isStartingOnAnotherDevice = false;\n\n  @State() isInProgress = null;\n\n  @State() isCancelling = null;\n\n  @State() statusHintCode: string = null;\n\n  @State() status: string = null;\n\n  @State() qrCodeImageUrl: string = null;\n\n  private axios = axios.create({\n    withCredentials: true,\n    withXSRFToken: true,\n  });\n\n  private timeout = null;\n\n  private TAG = '[jgroup-bank-id]';\n\n  private propsValid = true;\n\n  private propsValidationErrorMessage = null;\n\n  private translate = createTranslateFunction(this.language);\n\n  componentWillLoad() {\n    this.validateProps();\n\n    this.init = this.init.bind(this);\n    this.startOnAnotherDevice = this.startOnAnotherDevice.bind(this);\n    this.pollCollect = this.pollCollect.bind(this);\n    this.reset = this.reset.bind(this);\n    this.setFlowTypeBasedOnDevice();\n  }\n\n  render() {\n    if (!this.propsValid) {\n      return <p>{this.propsValidationErrorMessage}</p>;\n    }\n\n    return (\n      <Host>\n        {this.isInProgress === null ? (\n          <div class=\"flex flex-col items-center\">\n            <StartButton\n              isOutlined={false}\n              darkTheme={this.darkTheme}\n              onClick={this.init}\n              isLoading={this.isStarting && !this.isStartingOnAnotherDevice}\n              text={\n                this.flowType === 'qr' && !this.isStartingOnAnotherDevice\n                  ? this.translate('start-qr')\n                  : this.translate('start-app')\n              }\n            />\n            {this.isMobileOrTablet ? (\n              <div class=\"mt-4\">\n                <StartButton\n                  isOutlined={true}\n                  darkTheme={this.darkTheme}\n                  onClick={this.startOnAnotherDevice}\n                  isLoading={this.isStarting && this.isStartingOnAnotherDevice}\n                  text={this.translate('start-qr-another-device')}\n                />\n              </div>\n            ) : (\n              ''\n            )}\n          </div>\n        ) : (\n          ''\n        )}\n\n        {this.shouldRenderStatusHint ? (\n          <Alert\n            message={this.translate(\n              `hintcode-${this.flowType}-${this.statusHintCode || 'unknown'}`,\n              `hintcode-${this.statusHintCode || 'unknown'}`,\n            )}\n            type={this.status === 'failed' ? 'error' : 'info'}\n            tryAgainButtonText={this.translate('try-again')}\n            onTryAgainButtonClick={this.reset}\n          />\n        ) : (\n          ''\n        )}\n\n        {this.shouldRenderQrImage ? (\n          <img src={this.qrCodeImageUrl} class=\"mx-auto mb-4 animate-fade\" />\n        ) : (\n          ''\n        )}\n\n        {this.shouldRenderCancelButton ? (\n          <p class=\"text-center animate-fade\">\n            <CancelButton\n              onClick={this.reset}\n              text={this.translate('cancel')}\n              isLoading={this.isCancelling}\n            />\n          </p>\n        ) : (\n          ''\n        )}\n      </Host>\n    );\n  }\n\n  private get shouldRenderCancelButton() {\n    return this.flowType === 'qr' && this.isInProgress && this.timeout !== null;\n  }\n\n  private get shouldRenderQrImage() {\n    return (\n      this.isInProgress &&\n      this.flowType === 'qr' &&\n      this.qrCodeImageUrl !== null\n    );\n  }\n\n  private get shouldRenderStatusHint() {\n    return (\n      this.statusHintCode !== null &&\n      this.statusHintCode !== undefined &&\n      this.isInProgress !== null\n    );\n  }\n\n  private startOnAnotherDevice() {\n    this.isStartingOnAnotherDevice = true;\n    this.flowType = 'qr';\n    this.init();\n  }\n\n  private setFlowTypeBasedOnDevice() {\n    const { isMobileOrTablet } = useDevice();\n\n    this.isMobileOrTablet = isMobileOrTablet;\n    this.flowType = isMobileOrTablet ? 'app' : 'qr';\n  }\n\n  private validateProps() {\n    try {\n      this.validateType(this.type);\n      this.validateSignUrl(this.signUrl);\n      this.validateAuthUrl(this.authUrl);\n      this.validateCollectUrl(this.collectUrl);\n      this.validateCancelUrl(this.cancelUrl);\n    } catch (error) {\n      this.propsValid = false;\n      this.propsValidationErrorMessage = error.message;\n      console.error(error);\n    }\n  }\n\n  private throwError(message: string) {\n    throw new Error(`${this.TAG} ${message}`);\n  }\n\n  private async init() {\n    const url = this.type === 'auth' ? this.authUrl : this.signUrl;\n\n    this.isStarting = true;\n\n    const transaction = await this.post(url);\n\n    if (transaction === null) {\n      this.reset();\n      this.throwError(`Failed starting '${this.type}' transaction`);\n      return;\n    }\n\n    window.history.pushState({ triggeredByUser: true }, null);\n\n    return this.handleInitComplete(transaction);\n  }\n\n  private async handleInitComplete({ autoStartToken, transactionId }) {\n    if (this.flowType === 'qr') {\n      await this.pollCollect(transactionId);\n      this.isStarting = false;\n      this.isInProgress = true;\n    } else if (this.flowType === 'app') {\n      const returnUrl = this.createReturnUrl();\n\n      window.location.href = `https://app.bankid.com/?autostarttoken=${autoStartToken}&redirect=${returnUrl}`;\n    }\n  }\n\n  private pollCollect(transactionId: string = null) {\n    const getResult = async () => {\n      const response = await this.post(this.collectUrl);\n\n      if (response === null) {\n        console.warn(`${this.TAG} pollCollect returned null, clearing timeout`);\n        clearTimeout(this.timeout);\n\n        if (this.flowType === 'app') {\n          this.reset();\n        }\n        return;\n      }\n\n      if (transactionId && response.transactionId !== transactionId) {\n        await this.reset();\n        console.error(\n          `${this.TAG} resetting: initial transactionId '${transactionId}' does not match the one returned from collect '${response.transactionId}'.`,\n        );\n        return;\n      }\n\n      if (this.flowType === 'qr') {\n        this.qrCodeImageUrl = await getQrCodeImageUrl(response.qrCode);\n      }\n\n      this.statusHintCode = response.hintCode;\n      this.status = response.status;\n\n      switch (response.status) {\n        case 'pending':\n          this.timeout = setTimeout(() => {\n            getResult();\n          }, 1000);\n          break;\n\n        case 'failed':\n          this.isInProgress = false;\n          break;\n\n        case 'complete':\n          this.isInProgress = false;\n          window.location.hash = '';\n          this.completed.emit(response);\n          // this.reset();\n          break;\n\n        default:\n          console.warn(\n            `${this.TAG} pollCollect returned unknown status '${response.status}'`,\n          );\n          break;\n      }\n    };\n\n    return getResult();\n  }\n\n  private async reset() {\n    if (this.isInProgress) {\n      this.isCancelling = true;\n      await this.post(this.cancelUrl);\n    }\n\n    window.history.pushState({}, null);\n    this.isInProgress = null;\n    this.isStarting = false;\n    this.isStartingOnAnotherDevice = false;\n    this.isCancelling = null;\n    this.statusHintCode = null;\n    this.status = null;\n    this.qrCodeImageUrl = null;\n    this.setFlowTypeBasedOnDevice();\n    clearTimeout(this.timeout);\n  }\n\n  private createReturnUrl() {\n    const device = useDevice();\n\n    const location = window.location.href.replace('#', '');\n\n    if (device.isChromeOnAppleDevice || device.isChromeOnAndroidMobile) {\n      return encodeURIComponent('googlechrome://');\n    }\n    if (device.isFirefoxOnAppleDevice) {\n      return encodeURIComponent('firefox://');\n    }\n    if (device.isOperaTouchOnAppleDevice) {\n      return encodeURIComponent(\n        `${location.replace('http', 'touch-http')}#initiated=true`,\n      );\n    }\n\n    return encodeURIComponent(`${location}#initiated=true`);\n  }\n\n  private async post(url: string) {\n    try {\n      const response = await this.axios.post(url);\n\n      return response.data;\n    } catch (error) {\n      return null;\n    }\n  }\n}\n"]}